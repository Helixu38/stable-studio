---
import Close from "@/components/astro/ui/Close.astro";
import ArrowRightShort from "@/components/astro/ui/ArrowRightShort.astro";
---

<nav
	id="sidenav"
	class="fixed inset-0 z-[100] hidden size-full h-full items-stretch justify-end">
	<div
		id="sidenavScroll"
		class="relative flex max-h-full min-w-full max-w-full flex-col gap-7 overflow-auto bg-primary px-6 py-6 text-primary-foreground sm:min-w-[60vw] sm:max-w-[70vw] md:min-w-[35vw] md:px-16 md:py-28 lg:max-w-[50vw] 2xl:max-w-[30vw]">
		<button
			id="sidenavCloseButton"
			class="absolute right-4 top-4 size-8 md:size-10 lg:right-8 lg:top-8 3xl:size-16">
			<Close />
		</button>
		<div class="flex flex-col gap-4 md:hidden">
			<p
				class="whitespace-nowrap text-[0.65rem] font-normal uppercase leading-7 text-muted-foreground md:text-xs">
				/ sections /
			</p>
			<ul class="flex flex-col gap-4 uppercase">
				<li class="text-lg md:text-xl">
					<a href="#top">Top</a>
				</li>
				<li class="text-lg md:text-xl">
					<a href="#services">Service</a>
				</li>
				<li class="text-lg md:text-xl">
					<a href="#process">Development Process</a>
				</li>
				<li class="text-lg md:text-xl">
					<a href="#pricing">Pricing</a>
				</li>
				<li class="text-lg md:text-xl">
					<a href="#vision">Vision</a>
				</li>
				<li class="text-lg md:text-xl">
					<a href="#getstarted" class="flex items-center gap-1"
						>Get Started <span class="size-4"><ArrowRightShort /></span></a
					>
				</li>
			</ul>
		</div>
		<div class="flex flex-col gap-4 md:gap-7">
			<p
				class="whitespace-nowrap text-[0.65rem] font-normal uppercase leading-7 text-muted-foreground md:text-xs">
				/ language /
			</p>
			<div class="hidden flex-col items-start gap-2 md:flex">
				<h2 class="flex text-lg sm:text-2xl md:text-4xl">Switch language</h2>
				<p class="max-w-[400px] text-sm text-muted-foreground">
					Special thanks to my friends for provding the translations. If you
					would like to help translate, please contact me.
				</p>
			</div>
			<ul
				class="flex flex-col gap-4 text-primary-foreground/70 md:text-primary-foreground">
				<li class="text-sm md:text-lg">
					<a>English</a>
				</li>
				<li class="text-sm md:text-lg">
					<a>Tagalog</a>
				</li>
				<li class="text-sm md:text-lg">
					<a>Bahasa</a>
				</li>
				<li class="text-sm md:text-lg">
					<a>繁體中文</a>
				</li>
				<li class="text-sm md:text-lg">
					<a>简体中文</a>
				</li>
				<li class="text-sm md:text-lg">
					<a>日本語</a>
				</li>
				<li>
					<a
						href="/credits"
						class="block text-xs text-muted-foreground underline">
						<span class="sr-only">Go to credits page</span>
						Credits</a
					>
				</li>
			</ul>
		</div>
	</div>
</nav>

<style>
	#sidenav {
		transition: all 0.35s cubic-bezier(0.17, 0.84, 0.44, 1);
		backdrop-filter: blur(0);
		-webkit-backdrop-filter: blur(0);
	}
	#sidenav.sidenavDisplay {
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
	}

	#sidenav > div {
		transform: translate3d(100px, 0, 0);
		transition: all 0.5s cubic-bezier(0.17, 0.84, 0.44, 1);
		will-change: transform, opacity;
		opacity: 0.4;
	}

	#sidenav.sidenavDisplay > div {
		transform: translate3d(0, 0, 0);
		opacity: 1;
	}

	#sidenav.sidenavClose > div {
		transition:
			transform 0.5s cubic-bezier(0.17, 0.84, 0.44, 1),
			opacity 0.4s cubic-bezier(0.17, 0.84, 0.44, 1) 0.05s;
		transform: translate3d(100%, 0, 0);
		opacity: 0;
	}
</style>

<script>
	import Lenis from "lenis";
	import gsap from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";
	gsap.registerPlugin(ScrollTrigger);

	const sidenavScroll = document.getElementById("sidenavScroll");
	const sidenav = document.getElementById("sidenav");
	const sidenavCloseButton = document.getElementById("sidenavCloseButton");

	const lenis = new Lenis({
		wrapper: sidenavScroll!,
	});

	gsap.ticker.add((time) => {
		lenis.raf(time * 1000);
	});

	const closeSidenav = () => {
		if (!sidenav) return;
		sidenav.classList.remove("sidenavDisplay");
		sidenav.classList.add("sidenavClose");
		setTimeout(() => {
			sidenav.style.display = "none";
			sidenav.classList.remove("sidenavClose");
		}, 500);
	};
	sidenav?.addEventListener("click", (e) => {
		if (e.target !== sidenav) return;
		closeSidenav();
	});

	sidenavCloseButton?.addEventListener("click", closeSidenav);

	declare global {
		var closeSidenav: () => void;
	}

	window.closeSidenav = closeSidenav;
</script>
